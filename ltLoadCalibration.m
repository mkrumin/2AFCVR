function result = ltLoadCalibration(screen)% Loads the calibration file and sets applies it%% result = ltLoadCalibration(screen);% makes a gamma correction table that goes from 0 to 255 in 256 steps%% 1999 FH & MC % 2000-01 TCBF & MC added nreslutentries% 2000-03 MC made it indep of zmac, finds the most recent calibration% 2000-05 MC made it load a linear look-up table% 2004-09 VB now checks if NaNs in inverse gamma function% 2006-11 JBB upgraded to Windows PTB 3.x% 2008-01 MC and LB removed remnants of nreslutentries%% part of LabToolsdd = dir( fullfile(screen.CalibrationDir,'*.mat'));ncals = length(dd);% added by MC on 2007-02-20if ncals==0    error('There are no calibration files. Run ltCalibrateMonitor');enddates = zeros(ncals,1); % added by MC on 2009-09for ical = 1:ncals	dates(ical) = datenum(dd(ical).date);end% find the most recent fileifile = find(dates==max(dates));disp(['Latest calibration was done on ' dd(ifile).date])% load itload( fullfile(screen.CalibrationDir,dd(ifile).name) );% C=load('C:\Calibrate\3_x_Hanns-G_HA191_19-Aug-2010.mat');fprintf('For a %s monitor running at %3.1f Hz\n', C.MonitorType, C.FrameRate)% MT=Calibration.ScreenInfo.MonitorType;% FR=Calibration.ScreenInfo.FrameRate;% fprintf('For a %s monitor running at %3.1f Hz\n', MT, FR)if any(isnan(C.monitorGamInv))	error('Ouch! There are NaNs in inverse gamma function!')endoldGammaTable = Screen('ReadNormalizedGammaTable', screen.windowPtr);newGammaTable = C.monitorGamInv / 255;	% corrected to have linear luminanceScreen('LoadNormalizedGammaTable', screen.windowPtr, newGammaTable);result = newGammaTable - oldGammaTable;